<UserControl x:Class="Kanstraction.Views.AdminHubView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             x:Name="AdminRoot"
             xmlns:viewModels="clr-namespace:Kanstraction.ViewModels"
             Background="{DynamicResource MaterialDesignPaper}">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <!-- Header -->
            <RowDefinition Height="*"/>
            <!-- Content -->
        </Grid.RowDefinitions>

        <Border Grid.Row="0" Padding="10"
            Background="{DynamicResource MaterialDesignPaper}"
            BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="0,0,0,1">
            <TextBlock Text="{DynamicResource AdminHubView_Title}" FontWeight="SemiBold" />
        </Border>

        <TabControl x:Name="AdminTabs"
            Grid.Row="1"
            Background="{DynamicResource MaterialDesignPaper}"
            SelectionChanged="AdminTabs_SelectionChanged">
            <!-- MATERIALS -->
            <TabItem Header="{DynamicResource AdminHubView_MaterialsTab}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="320"/>
                        <ColumnDefinition Width="6"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- Master -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Margin="10,10,10,4">
                            <TextBox x:Name="MatSearchBox"
                       materialDesign:HintAssist.Hint="{DynamicResource AdminHubView_SearchMaterialsHint}"
                       Padding="8" TextChanged="MatSearchBox_TextChanged"
                       Style="{StaticResource MaterialDesignOutlinedTextBox}" />
                            <CheckBox x:Name="MatActiveOnly"
                        Content="{DynamicResource AdminHubView_ActiveOnly}" Margin="0,8,0,0"
                        IsChecked="True" Checked="MatFilterChanged" Unchecked="MatFilterChanged"/>
                            <ComboBox x:Name="MatCategoryFilter"
                                      Margin="0,8,0,0"
                                      Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                      materialDesign:HintAssist.Hint="{DynamicResource AdminHubView_FilterByCategory}"
                                      IsEditable="True"
                                      IsTextSearchEnabled="True"
                                      StaysOpenOnEdit="True"
                                      TextSearch.TextPath="Name"
                                      DisplayMemberPath="Name"
                                      SelectedValuePath="Id"
                                      SelectionChanged="MatFilterChanged" />
                        </StackPanel>

                        <ListView x:Name="MaterialsList" Grid.Row="1" Margin="10"
                      SelectionChanged="MaterialsList_SelectionChanged"
                      DisplayMemberPath="Name" />

                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="10,4,10,10" HorizontalAlignment="Right">
                            <Button Content="{DynamicResource AdminHubView_New}" Click="NewMaterial_Click" Margin="6,0" Style="{StaticResource MaterialDesignOutlinedButton}"/>
                        </StackPanel>
                    </Grid>

                    <GridSplitter Grid.Column="1" Width="6" Background="{DynamicResource MaterialDesignDivider}"
                        ResizeBehavior="PreviousAndNext" ShowsPreview="True"/>

                    <!-- Detail -->
                    <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto">
                        <Border x:Name="MaterialEditorBorder" Margin="16" Padding="14"
                Background="{DynamicResource MaterialDesignCardBackground}"
                CornerRadius="8" MinWidth="360">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Setter Property="BorderBrush" Value="{DynamicResource MaterialDesignDivider}"/>
                                    <Setter Property="BorderThickness" Value="1"/>
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding IsMaterialDirty, ElementName=AdminRoot}" Value="True">
                                            <Setter Property="BorderBrush" Value="#E67E22"/>
                                            <Setter Property="BorderThickness" Value="2"/>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <StackPanel>
                                <TextBlock Text="{DynamicResource AdminHubView_MaterialHeader}" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                <DockPanel Margin="0,0,0,8">
                                    <TextBlock Text="{DynamicResource AdminHubView_Name}" Width="120" VerticalAlignment="Center"/>
                                    <TextBox x:Name="MatName" Padding="8" TextChanged="MaterialEditor_TextChanged" />
                                </DockPanel>
                                <DockPanel Margin="0,0,0,8">
                                    <TextBlock Text="{DynamicResource AdminHubView_Category}" Width="120" VerticalAlignment="Center"/>
                                    <Grid Margin="0">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <ComboBox x:Name="MatCategory"
                                                  Grid.Column="0"
                                                  MinWidth="220"
                                                  Padding="8"
                                                  Style="{StaticResource MaterialDesignOutlinedComboBox}"
                                                  materialDesign:HintAssist.Hint="{DynamicResource Common_Required}"
                                                  IsEditable="True"
                                                  IsTextSearchEnabled="True"
                                                  StaysOpenOnEdit="True"
                                                  TextSearch.TextPath="Name"
                                                  DisplayMemberPath="Name"
                                                  SelectedValuePath="Id"
                                                  SelectionChanged="MatCategory_SelectionChanged" />
                                        <Button Grid.Column="1"
                                                Margin="8,0,0,0"
                                                Style="{StaticResource TinyIconButton}"
                                                Width="32"
                                                Height="32"
                                                Background="#3f51b5"
                                                Click="AddCategory_Click"
                                                ToolTip="{DynamicResource AdminHubView_AddCategoryTooltip}">
                                            <iconPacks:PackIconFontAwesome Kind="PlusSolid" Width="14" Height="14" Foreground="White"/>
                                        </Button>
                                    </Grid>
                                </DockPanel>
                                <DockPanel Margin="0,0,0,8">
                                    <TextBlock Text="{DynamicResource AdminHubView_Unit}" Width="120" VerticalAlignment="Center"/>
                                    <TextBox x:Name="MatUnit" Padding="8" TextChanged="MaterialEditor_TextChanged" />
                                </DockPanel>
                                <DockPanel Margin="0,0,0,8">
                                    <TextBlock Text="{DynamicResource AdminHubView_PricePerUnit}" Width="120" VerticalAlignment="Center"/>
                                    <TextBox x:Name="MatPrice" Padding="8" TextChanged="MaterialEditor_TextChanged" />
                                </DockPanel>

                                <CheckBox x:Name="MatIsActive" Content="{DynamicResource AdminHubView_Active}" Margin="0,0,0,8" IsChecked="True"
                               Checked="MaterialEditor_CheckChanged" Unchecked="MaterialEditor_CheckChanged"/>

                                <Separator Margin="0,8,0,8"/>

                                <TextBlock Text="{DynamicResource AdminHubView_PriceHistory}" FontWeight="SemiBold" Margin="0,0,0,8"/>
                                <DataGrid x:Name="MatHistoryGrid" AutoGenerateColumns="False" IsReadOnly="True"
                        CanUserSortColumns="False"
                        HeadersVisibility="Column" GridLinesVisibility="None"
                        Height="200" Margin="0,0,0,8"
                        Style="{StaticResource MaterialDesignDataGrid}">
                                    <DataGrid.Columns>
                                        <DataGridTextColumn Header="{DynamicResource AdminHubView_Start}" Binding="{Binding StartDate}"/>
                                        <DataGridTextColumn Header="{DynamicResource AdminHubView_End}" Binding="{Binding EndDate}"/>
                                        <DataGridTextColumn Header="{DynamicResource AdminHubView_PricePerUnit}" Binding="{Binding PricePerUnit}"/>
                                    </DataGrid.Columns>
                                </DataGrid>

                                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                    <Button Content="{DynamicResource AdminHubView_Save}" Click="SaveMaterial_Click" Margin="6,0" Style="{StaticResource MaterialDesignOutlinedButton}"/>
                                    <Button Content="{DynamicResource AdminHubView_Cancel}" Click="CancelMaterial_Click" Margin="6,0"/>
                                </StackPanel>
                            </StackPanel>
                        </Border>
                    </ScrollViewer>
                </Grid>
            </TabItem>

            <TabItem Header="{DynamicResource AdminHubView_StagePresetsTab}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="320"/>
                        <!-- master -->
                        <ColumnDefinition Width="6"/>
                        <!-- splitter -->
                        <ColumnDefinition Width="*"/>
                        <!-- designer host -->
                    </Grid.ColumnDefinitions>

                    <!-- MASTER (left) -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <!-- Search + filter -->
                        <StackPanel Grid.Row="0" Margin="10,10,10,4">
                            <TextBox x:Name="PresetSearchBox"
                 materialDesign:HintAssist.Hint="{DynamicResource AdminHubView_SearchPresetsHint}"
                 Padding="8"
                 TextChanged="PresetSearchBox_TextChanged"
                 Style="{StaticResource MaterialDesignOutlinedTextBox}" />
                            <CheckBox x:Name="PresetActiveOnly"
                  Content="{DynamicResource AdminHubView_ActiveOnly}" Margin="0,8,0,0"
                  IsChecked="True"
                  Checked="PresetFilterChanged" Unchecked="PresetFilterChanged"/>
                        </StackPanel>

                        <!-- List -->
                        <ListView x:Name="PresetsList" Grid.Row="1" Margin="10"
                DisplayMemberPath="Name"
                SelectionChanged="PresetsList_SelectionChanged" />

                        <!-- Actions -->
                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="10,4,10,10" HorizontalAlignment="Right">
                            <Button Content="{DynamicResource AdminHubView_New}" Click="NewPreset_Click" Margin="6,0" Style="{StaticResource MaterialDesignOutlinedButton}"/>
                        </StackPanel>
                    </Grid>

                    <!-- Splitter -->
                    <GridSplitter Grid.Column="1" Width="6"
                  Background="{DynamicResource MaterialDesignDivider}"
                  ResizeBehavior="PreviousAndNext" ShowsPreview="True"/>

                    <!-- DESIGNER (right) -->
                    <viewModels:StagePresetDesignerView x:Name="PresetDesigner" Grid.Column="2" />
                </Grid>
            </TabItem>

            <!-- BUILDING TYPES -->
            <TabItem Header="{DynamicResource AdminHubView_BuildingTypes}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="320"/>
                        <ColumnDefinition Width="6"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <!-- MASTER (left) -->
                    <Grid Grid.Column="0">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0" Margin="10,10,10,4">
                            <TextBox x:Name="BtSearchBox"
                 materialDesign:HintAssist.Hint="{DynamicResource AdminHubView_FilterBuildingTypes}"
                 Padding="8" TextChanged="BtSearchBox_TextChanged"
                 Style="{StaticResource MaterialDesignOutlinedTextBox}" />
                            <CheckBox x:Name="BtActiveOnly"
                  Content="{DynamicResource AdminHubView_ActiveOnly}" Margin="0,8,0,0"
                  IsChecked="True" Checked="BtFilterChanged" Unchecked="BtFilterChanged"/>
                        </StackPanel>

                        <ListView x:Name="BuildingTypesList" Grid.Row="1" Margin="10"
                SelectionChanged="BuildingTypesList_SelectionChanged"
                DisplayMemberPath="Name" />

                        <StackPanel Grid.Row="2" Orientation="Horizontal" Margin="10,4,10,10" HorizontalAlignment="Right">
                            <Button Content="{DynamicResource AdminHubView_New}" Click="NewBuildingType_Click" Margin="6,0" Style="{StaticResource MaterialDesignOutlinedButton}"/>
                        </StackPanel>
                    </Grid>

                    <GridSplitter Grid.Column="1" Width="6" Background="{DynamicResource MaterialDesignDivider}"
                  ResizeBehavior="PreviousAndNext" ShowsPreview="True"/>

                    <!-- DETAIL / COMPOSER (right) -->
                    <ScrollViewer Grid.Column="2" VerticalScrollBarVisibility="Auto">
                        <StackPanel Margin="16" MinWidth="460">

                            <!-- 1) HEADER CARD -->
                            <Border Padding="14"
                Background="{DynamicResource MaterialDesignCardBackground}"
                CornerRadius="8"
                Margin="0,0,0,12">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="BorderBrush" Value="{DynamicResource MaterialDesignDivider}"/>
                                        <Setter Property="BorderThickness" Value="1"/>
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsBuildingDirty, ElementName=AdminRoot}" Value="True">
                                                <Setter Property="BorderBrush" Value="#E67E22"/>
                                                <Setter Property="BorderThickness" Value="2"/>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*"/>
                                        <ColumnDefinition Width="140"/>
                                    </Grid.ColumnDefinitions>

                                    <StackPanel Grid.Column="0">
                                        <TextBlock Text="{DynamicResource AdminHubView_BuildingTypes}" FontWeight="SemiBold"/>
                                        <TextBox x:Name="BtName"
                       Style="{StaticResource MaterialDesignOutlinedTextBox}"
                       materialDesign:HintAssist.Hint="{DynamicResource AdminHubView_Name}"
                       Padding="10"
                       FontSize="14"
                       Margin="0,6,0,4"
                       TextChanged="BuildingEditor_TextChanged"/>
                                        <TextBlock Text="{DynamicResource AdminHubView_NewBuildingType}" 
                         Foreground="{DynamicResource MaterialDesignBodyLight}" FontSize="12"/>
                                    </StackPanel>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" HorizontalAlignment="Right">
                                        <CheckBox x:Name="BtActive" Content="{DynamicResource AdminHubView_Active}" IsChecked="True"
                                   Checked="BuildingEditor_CheckChanged" Unchecked="BuildingEditor_CheckChanged"/>
                                    </StackPanel>
                                </Grid>
                            </Border>

                            <!-- 2) ASSIGN PRESETS CARD -->
                            <Border Padding="14"
        Background="{DynamicResource MaterialDesignCardBackground}"
        BorderBrush="{DynamicResource MaterialDesignDivider}"
        BorderThickness="1" CornerRadius="8"
        Margin="0,0,0,12">
                                <Grid>
                                    <Grid.RowDefinitions>
                                        <RowDefinition Height="Auto"/>
                                        <!-- header + picker -->
                                        <RowDefinition Height="10"/>
                                        <RowDefinition Height="*"/>
                                        <!-- two-panel body -->
                                        <RowDefinition Height="Auto"/>
                                        <!-- tip -->
                                    </Grid.RowDefinitions>

                                    <!-- Header + Picker -->
                                    <StackPanel Grid.Row="0" Margin="0,0,0,4">
                                        <TextBlock Text="{DynamicResource AdminHubView_AssignStagePresets}" FontWeight="SemiBold" />
                                        <StackPanel Orientation="Horizontal" Margin="0,10,0,0">
                                            <ComboBox x:Name="BtPresetPicker"
                  Width="320"
                  Style="{StaticResource MaterialDesignOutlinedComboBox}"
                  DisplayMemberPath="Name" SelectedValuePath="Id"
                  materialDesign:HintAssist.Hint="{DynamicResource AdminHubView_ChoosePresetHint}"
                  Margin="0,0,8,0"/>
                                            <Button Content="{DynamicResource Common_Add}" Click="AddPresetToBuildingType_Click"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <!-- Three-panel body -->
                                    <Grid Grid.Row="2">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="8" />
                                            <ColumnDefinition Width="*" />
                                            <ColumnDefinition Width="8" />
                                            <ColumnDefinition Width="1.4*" />
                                        </Grid.ColumnDefinitions>

                                        <!-- LEFT: Assigned presets -->
                                        <DataGrid x:Name="BtAssignedGrid"
                                                  Grid.Column="0"
                                                  Height="300"
                                                  AutoGenerateColumns="False" CanUserAddRows="False" CanUserSortColumns="False"
                                                  HeadersVisibility="Column" GridLinesVisibility="None"
                                                  SelectionChanged="BtAssignedGrid_SelectionChanged"
                                                  Style="{StaticResource MaterialDesignDataGrid}">
                                            <DataGrid.Columns>
                                                <DataGridTextColumn Header="#" Binding="{Binding OrderIndex}" Width="50" IsReadOnly="True"/>
                                                <DataGridTextColumn Header="{DynamicResource AdminHubView_AssignedPresets}" Binding="{Binding Name}" Width="*" IsReadOnly="True"/>
                                                <DataGridTextColumn Header="{DynamicResource AdminHubView_SubStages}" Binding="{Binding SubStageCount}" Width="110" IsReadOnly="True"/>
                                                <DataGridTemplateColumn Header="{DynamicResource AdminHubView_Order}" Width="120">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center">
                                                                <Button Style="{StaticResource TinyIconButton}" Tag="{Binding}" Background="#3f51b5" Click="BtMoveUp_Click" Width="20" Height="20">
                                                                    <iconPacks:PackIconFontAwesome Kind="ArrowUpSolid"   Foreground="White" Width="14" Height="14" />
                                                                </Button>
                                                                <Button Style="{StaticResource TinyIconButton}" Margin="2" Background="#3f51b5" Tag="{Binding}" Click="BtMoveDown_Click" Width="20" Height="20">
                                                                    <iconPacks:PackIconFontAwesome Kind="ArrowDownSolid" Foreground="White" Width="14" Height="14" />
                                                                </Button>
                                                            </StackPanel>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>

                                                <DataGridTemplateColumn Header="" Width="80">
                                                    <DataGridTemplateColumn.CellTemplate>
                                                        <DataTemplate>
                                                            <Button Style="{StaticResource TinyIconButton}" Tag="{Binding}" Click="BtRemoveAssigned_Click">
                                                                <iconPacks:PackIconFontAwesome Kind="TrashCanRegular" Width="16" Height="16" Foreground="Red"/>
                                                            </Button>
                                                        </DataTemplate>
                                                    </DataGridTemplateColumn.CellTemplate>
                                                </DataGridTemplateColumn>
                                            </DataGrid.Columns>
                                        </DataGrid>

                                        <!-- Splitter between assigned presets and sub-stages -->
                                        <GridSplitter Grid.Column="1"
                                                      Width="8"
                                                      Background="{DynamicResource PrimaryHueMidBrush}"
                                                      HorizontalAlignment="Stretch"
                                                      ResizeBehavior="PreviousAndNext"
                                                      ShowsPreview="True"
                                                      Cursor="SizeWE"/>

                                        <!-- MIDDLE: Sub-stages with labor cost editing -->
                                        <Border Grid.Column="2" Padding="10"
                                                Background="{DynamicResource MaterialDesignCardBackground}"
                                                BorderBrush="{DynamicResource MaterialDesignDivider}"
                                                BorderThickness="1" CornerRadius="8">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="*" />
                                                </Grid.RowDefinitions>

                                                <TextBlock x:Name="BtSelectedPresetTitle"
                                                           Text="{DynamicResource AdminHubView_SelectedPresetTitle}"
                                                           FontWeight="SemiBold"
                                                           Margin="0,0,0,8"/>

                                                <DataGrid x:Name="BtSubStagesGrid"
                                                          Grid.Row="1"
                                                          AutoGenerateColumns="False" CanUserAddRows="False" CanUserSortColumns="False"
                                                          HeadersVisibility="Column" GridLinesVisibility="None"
                                                          IsReadOnly="False"
                                                          SelectionChanged="BtSubStagesGrid_SelectionChanged"
                                                          Style="{StaticResource MaterialDesignDataGrid}">
                                                    <DataGrid.Columns>
                                                        <DataGridTextColumn Header="#" Binding="{Binding OrderIndex}" Width="60" IsReadOnly="True"/>
                                                        <DataGridTextColumn Header="{DynamicResource AdminHubView_SubStages}" Binding="{Binding Name}" Width="*" IsReadOnly="True"/>
                                                        <DataGridTextColumn Header="{DynamicResource AdminHubView_Labor}" Binding="{Binding LaborCost, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:0.##}}" Width="140"/>
                                                    </DataGrid.Columns>
                                                </DataGrid>
                                            </Grid>
                                        </Border>

                                        <!-- Splitter between sub-stages and materials -->
                                        <GridSplitter Grid.Column="3"
                                                      Width="8"
                                                      Background="{DynamicResource PrimaryHueMidBrush}"
                                                      HorizontalAlignment="Stretch"
                                                      ResizeBehavior="PreviousAndNext"
                                                      ShowsPreview="True"
                                                      Cursor="SizeWE"/>

                                        <!-- RIGHT: Materials panel for selected sub-stage -->
                                        <Border Grid.Column="4" Padding="10"
                                                Background="{DynamicResource MaterialDesignCardBackground}"
                                                BorderBrush="{DynamicResource MaterialDesignDivider}"
                                                BorderThickness="1" CornerRadius="8">
                                            <Grid>
                                                <Grid.RowDefinitions>
                                                    <RowDefinition Height="Auto"/>
                                                    <RowDefinition Height="*" />
                                                </Grid.RowDefinitions>

                                                <TextBlock x:Name="BtSelectedSubStageTitle"
                                                           Text="{DynamicResource AdminHubView_SelectSubStagePrompt}"
                                                           FontWeight="SemiBold"
                                                           Margin="0,0,0,8"/>

                                                <Grid Grid.Row="1">
                                                    <DataGrid x:Name="BtMaterialsGrid"
                                                              AutoGenerateColumns="False" CanUserAddRows="False" CanUserDeleteRows="False" CanUserSortColumns="False"
                                                              HeadersVisibility="Column" GridLinesVisibility="None"
                                                              IsReadOnly="False"
                                                              Style="{StaticResource MaterialDesignDataGrid}">
                                                        <DataGrid.Columns>
                                                            <DataGridTextColumn Header="{DynamicResource AdminHubView_Materials}" Binding="{Binding DisplayLabel}" Width="*" IsReadOnly="True"/>
                                                            <DataGridTextColumn Header="{DynamicResource AdminHubView_DefaultQuantity}" Width="120">
                                                                <DataGridTextColumn.ElementStyle>
                                                                    <Style TargetType="TextBlock">
                                                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                                                    </Style>
                                                                </DataGridTextColumn.ElementStyle>
                                                                <DataGridTextColumn.Binding>
                                                                    <Binding Path="BaseQty" StringFormat="{}{0:0.##}" TargetNullValue="—" />
                                                                </DataGridTextColumn.Binding>
                                                            </DataGridTextColumn>
                                                            <DataGridTemplateColumn Header="{DynamicResource AdminHubView_OverrideQuantity}" Width="140">
                                                                <DataGridTemplateColumn.CellTemplate>
                                                                    <DataTemplate>
                                                                        <TextBox Width="120"
                                                                                 HorizontalContentAlignment="Right"
                                                                                 Text="{Binding Qty, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged, StringFormat={}{0:0.##}}"/>
                                                                    </DataTemplate>
                                                                </DataGridTemplateColumn.CellTemplate>
                                                            </DataGridTemplateColumn>
                                                        </DataGrid.Columns>
                                                    </DataGrid>
                                                    <TextBlock x:Name="BtMaterialsPlaceholder"
                                                               Text="{DynamicResource AdminHubView_SelectSubStagePrompt}"
                                                               TextWrapping="Wrap"
                                                               HorizontalAlignment="Center"
                                                               VerticalAlignment="Center"
                                                               Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                                </Grid>
                                            </Grid>
                                        </Border>
                                    </Grid>

                                    <!-- Tip -->
                                    <TextBlock Grid.Row="3"
               Text="{DynamicResource AdminHubView_Tip}"
               Foreground="{DynamicResource MaterialDesignBodyLight}" FontSize="12" Margin="0,8,0,0"/>
                                </Grid>
                            </Border>

                            <!-- 3) ACTIONS -->
                            <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                                <Button Content="{DynamicResource AdminHubView_SaveBuildingType}" Click="SaveBuildingType_Click"
                  Style="{StaticResource MaterialDesignOutlinedButton}" Margin="0,0,8,0"/>
                                <Button Content="{DynamicResource AdminHubView_CancelBuildingType}" Click="CancelBuildingType_Click"/>
                            </StackPanel>
                        </StackPanel>
                    </ScrollViewer>
                </Grid>
            </TabItem>
        </TabControl>
    </Grid>
</UserControl>
